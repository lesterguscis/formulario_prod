<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario con Firma</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        form { max-width: 500px; margin: auto; }
        label { display: block; margin-top: 10px; font-weight: bold; }
        input, select, button { width: 100%; padding: 8px; margin-top: 5px; }
        canvas { border: 1px solid #000; width: 100%; height: 200px; }
    </style>
</head>
<body>
    <h2>Registro con Firma</h2>
    <form action="/submit" method="post" enctype="multipart/form-data">
        <label>Nombre y Apellidos</label>
        <input type="text" name="nombre" required>

        <label>CI (11 dígitos)</label>
        <input type="text" name="ci" pattern="\d{11}" required>

        <label>Fecha de envío</label>
        <input type="date" name="fecha_envio" required>

        <label>Provincia</label>
        <select name="provincia" required>
            <option value="">Seleccione...</option>
            <option>Pinar del Río</option>
            <option>Artemisa</option>
            <option>La Habana</option>
            <option>Mayabeque</option>
            <option>Matanzas</option>
            <option>Cienfuegos</option>
            <option>Villa Clara</option>
            <option>Sancti Spíritus</option>
            <option>Ciego de Ávila</option>
            <option>Camagüey</option>
            <option>Las Tunas</option>
            <option>Holguín</option>
            <option>Granma</option>
            <option>Santiago de Cuba</option>
            <option>Guantánamo</option>
            <option>Isla de la Juventud</option>
        </select>

        <label>Correo</label>
        <input type="email" name="correo" required>

        <label>Teléfono</label>
        <input type="tel" name="telefono" required>

        <label>Firma</label>
        <canvas id="signature-pad"></canvas>
        <button type="button" id="clear">Borrar</button>
        <input type="hidden" name="firma" id="firma">

        <br><br>
        <button type="submit">Enviar</button>
    </form>

    <!-- ✅ Librería Signature Pad desde CDN -->
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>

    <script>
        const canvas = document.getElementById('signature-pad');
        const signaturePad = new SignaturePad(canvas);

        document.getElementById('clear').addEventListener('click', () => {
            signaturePad.clear();
        });

        // Antes de enviar, guardamos la firma en el input hidden
        document.querySelector("form").addEventListener("submit", function(e) {
            if (!signaturePad.isEmpty()) {
                document.getElementById('firma').value = signaturePad.toDataURL();
            } else {
                alert("Por favor, firme antes de enviar.");
                e.preventDefault();
            }
        });
    </script>
</body>
</html>